--Group8
--Hospital management system
--DDL


DROP SCHEMA IF EXISTS HOSPITAL_MANAGEMENT CASCADE;
CREATE SCHEMA HOSPITAL_MANAGEMENT;
SET SEARCH_PATH TO HOSPITAL_MANAGEMENT;

CREATE TABLE Department (
    Department_ID CHAR(3) PRIMARY KEY,
    Department_Name TEXT NOT NULL,
    Room_no DECIMAL(3) NOT NULL,
    Floor_no DECIMAL(1) NOT NULL,
	HOD_ID CHAR(6) NOT NULL
);

CREATE TABLE GENERAL_INFORMATION (
    ID CHAR(6) PRIMARY KEY,
    BLOOD_GROUP VARCHAR(3) NOT NULL,
    WEIGHT DECIMAL(4,1) NOT NULL,
    HEIGHT DECIMAL(4,1) NOT NULL
);

CREATE TABLE Address_Contact_Information (
    ID CHAR(6) PRIMARY KEY,
    Apartment_no VARCHAR(10),
    Street_no VARCHAR(10),
    Street_Name TEXT,
    City VARCHAR(20) NOT NULL,
    State VARCHAR(20) NOT NULL,
    Pincode DECIMAL(6) NOT NULL
);

CREATE TABLE Employee (
    Employee_ID CHAR(6) PRIMARY KEY,
    Employee_Name TEXT NOT NULL,
    Date_Of_Birth DATE NOT NULL,
    Gender CHAR(1) NOT NULL,
    Joining_Date DATE NOT NULL,
    Retirement_Date DATE NOT NULL,
    Salary INT NOT NULL,
    Qualification TEXT NOT NULL,
    Department_ID CHAR(3) NOT NULL,
    FOREIGN KEY (Department_ID) REFERENCES Department(Department_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (Employee_ID) REFERENCES Address_Contact_Information(ID) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (Employee_ID) REFERENCES GENERAL_INFORMATION(ID) ON DELETE CASCADE ON UPDATE CASCADE
);


CREATE TABLE Vehicle (
    Vehicle_ID DECIMAL(2) PRIMARY KEY,
    No_Plate CHAR(10) NOT NULL,
    Vehicle_Type VARCHAR(10) NOT NULL
);


CREATE TABLE INVENTORY (
    Inventory_ID CHAR(6) PRIMARY KEY,
    Inventory_Name TEXT NOT NULL,
    Price DECIMAL NOT NULL,
    Quantity DECIMAL NOT NULL
);

CREATE TABLE Patient (
    Patient_ID CHAR(6) PRIMARY KEY,
    Gender CHAR(1) NOT NULL,
    Patient_Name TEXT NOT NULL,
    Date_Of_Birth DATE NOT NULL,
    FOREIGN KEY (Patient_ID) REFERENCES Address_Contact_Information(ID) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (Patient_ID) REFERENCES GENERAL_INFORMATION(ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE DOCTOR(
    DOCTOR_ID CHAR(6) PRIMARY KEY REFERENCES Employee(Employee_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    Experience DECIMAL(2) NOT NULL
);

CREATE TABLE Death_Record (
    Patient_ID CHAR(6) PRIMARY KEY REFERENCES Patient(Patient_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    Date_Of_Death DATE NOT NULL,
    Cause_Of_Death TEXT NOT NULL
);

CREATE TABLE DONOR (
    DONOR_ID CHAR(6),
    DONATE_DATE DATE,
    PRIMARY KEY(DONOR_ID,DONATE_DATE),
    DONOR_NAME TEXT NOT NULL,
    REIMBURSEMENT INT NOT NULL,
    DONATION_TYPE TEXT NOT NULL,
    FOREIGN KEY (DONOR_ID) REFERENCES GENERAL_INFORMATION(ID) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (DONOR_ID) REFERENCES Address_Contact_Information(ID) ON DELETE CASCADE ON UPDATE CASCADE
);


CREATE TABLE DRIVER (
    DRIVER_ID CHAR(6) PRIMARY KEY REFERENCES Employee(Employee_ID),
    LICENCE_NO CHAR(14) NOT NULL 
);


CREATE TABLE Driven_by (
    Vehicle_ID DECIMAL(2),
    Driver_ID CHAR(6),
    NURSE_ID CHAR(6) NOT NULL,
    PRIMARY KEY (Vehicle_ID, Driver_ID),
    FOREIGN KEY (Vehicle_ID) REFERENCES Vehicle(Vehicle_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (Driver_ID) REFERENCES Driver(DRIVER_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE Examined_By (
    Patient_ID CHAR(6) REFERENCES Patient(Patient_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    DOCTOR_ID CHAR(6) REFERENCES DOCTOR(DOCTOR_ID) ON DELETE CASCADE ON UPDATE CASCADE,
	Admit_Date DATE ,
    Discharge_Date DATE NOT NULL,
    PRIMARY KEY (Admit_Date, Patient_ID, DOCTOR_ID),
	Vehicle_ID DECIMAL(3) ,
	Driver_ID CHAR(6) , 
    FOREIGN KEY (Vehicle_ID, Driver_ID) REFERENCES Driven_By(Vehicle_ID, Driver_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE BILL (
    Bill_no CHAR(4) PRIMARY KEY,
    Amount INT NOT NULL,
    Card_Relief DECIMAL(4,2) NOT NULL,
    Payment_Status DECIMAL(1,0) NOT NULL,
    Bill_Date DATE NOT NULL,
    Payment_Mode VARCHAR(10) NOT NULL,
    PATIENT_ID CHAR(6) NOT NULL,
    FOREIGN KEY (PATIENT_ID) REFERENCES Patient(Patient_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE BED (
    Bed_ID CHAR(10) PRIMARY KEY,
    Room_no DECIMAL(3) NOT NULL,
    Floor_no DECIMAL(1) NOT NULL,
    Ward_no CHAR(4),
    Patient_ID CHAR(6) REFERENCES Patient(Patient_ID) ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE Mobile_No (
    ID CHAR(6) REFERENCES Address_Contact_Information(ID) ON DELETE CASCADE ON UPDATE CASCADE, 
    Mobile_No DECIMAL(10) , 
	primary key (ID , Mobile_No)
);

CREATE TABLE Email_ID (
    ID CHAR(6) REFERENCES Address_Contact_Information(ID) ON DELETE CASCADE ON UPDATE CASCADE, 
    Email_ID VARCHAR(321) ,
	PRIMARY KEY (ID , Email_ID)
);

CREATE TABLE ATTENDANCE (
    EMPLOYEE_ID CHAR(6), 
    DATE_OF_LEAVE DATE,
	FOREIGN KEY (EMPLOYEE_ID) REFERENCES Employee(Employee_ID) ON DELETE CASCADE ON UPDATE CASCADE,
	PRIMARY KEY(EMPLOYEE_ID,DATE_OF_LEAVE)
);

CREATE TABLE AVAILABLE_TIME (
    EMPLOYEE_ID CHAR(6) REFERENCES Employee(Employee_ID) ON DELETE CASCADE ON UPDATE CASCADE,
	AVAILABLE_FROM TIME NOT NULL,
	AVAILABLE_TO TIME NOT NULL,
	PRIMARY KEY (EMPLOYEE_ID,AVAILABLE_FROM)

);

CREATE TABLE AVAILABLE_DAY(
	EMPLOYEE_ID CHAR(6) PRIMARY KEY REFERENCES Employee(Employee_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    DAYS_OF_WEEK VARCHAR(11) NOT NULL
);


CREATE TABLE TRUSTEE (
    Trustee_ID CHAR(6),
    Trustee_Name TEXT NOT NULL,
    Donation_Date DATE NOT NULL,
	PRIMARY KEY(Trustee_ID,Donation_Date),
    Amount INT NOT NULL,
    FOREIGN KEY (Trustee_ID) REFERENCES Address_Contact_Information(ID) ON DELETE CASCADE ON UPDATE CASCADE
);


CREATE TABLE Department_Has_Inventory (
    Inventory_ID CHAR(6),
    Department_ID CHAR(3),
	Quantity_Associated int,
    PRIMARY KEY (Inventory_ID, Department_ID),
    FOREIGN KEY (Inventory_ID) REFERENCES Inventory(Inventory_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (Department_ID) REFERENCES Department(Department_ID) ON DELETE CASCADE ON UPDATE CASCADE
);
